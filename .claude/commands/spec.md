---
description: 스펙 작성 모드 활성화 - Feature 스펙 문서를 SDD 원칙에 따라 작성
runOn: project
---

# 스펙 작성 모드

**IMPORTANT**: `.claude/guides/spec-mode.md`를 읽고 그 내용을 따라 진행합니다.

## 입력 파라미터 분석

사용자가 전달한 인자를 파싱합니다: $ARGUMENTS

인자는 다음 형태 중 하나입니다. 형태를 판별하여 적절히 처리합니다:

| 형태 | 예시 | 처리 방식 |
|------|------|----------|
| **인자 없음** | `/spec` | 사용자에게 어떤 스펙을 작성할지 질문 |
| **Feature/플랫폼 식별자** | `F17-주문-M` | → **소스 분석 모드**: 모듈 인덱스에서 관련 기존 소스 모듈을 찾아 분석 |
| **기존 소스 모듈명** | `order`, `fieldTalk` | → **소스 분석 모드**: 기존 소스의 해당 모듈을 직접 분석 |
| **기존 스펙 문서명** | `F59-알림-M.md` | 기존 스펙을 찾아 수정/보완 |
| **자유 텍스트** | `주문 관리`, `Docker 세팅`, `푸시 알림 설정` | → 모듈 인덱스 매칭 시도 → 매칭되면 **소스 분석 모드**, 매칭 실패 시 **대화 기반 모드** |

### 판별 규칙

1. `F숫자-` 패턴으로 시작하고 `-M`, `-B`, `-W`로 끝나면 → **Feature/플랫폼 식별자** → 소스 분석 모드
2. `.md` 확장자가 포함되어 있으면 → **기존 스펙 문서명**
3. 영문 소문자 또는 camelCase이고 모듈 인덱스에 존재 → **기존 소스 모듈명** → 소스 분석 모드
4. 그 외 자유 텍스트 → 모듈 인덱스 + controller-guide 검색
   - 매칭 성공 → **소스 분석 모드** (사용자에게 매칭 결과 확인)
   - 매칭 실패 → **대화 기반 모드** (사용자에게 "기존 소스에 해당 모듈이 없습니다. 대화를 통해 스펙을 작성합니다." 안내)

### 모듈 탐색 절차 (소스 분석 모드)

1. `docs/specs/기존소스-모듈-인덱스.md` 읽기
2. 키워드로 모듈명/한글명/Feature 번호 매칭
3. 매칭되는 모듈이 여러 개면 사용자에게 선택 요청
4. 매칭 실패 시 `docs/plan/기존소스/otg_PowerSales-master/docs/controller-guide.md`에서 엔드포인트 설명을 검색
5. 여전히 매칭 실패 → 대화 기반 모드로 전환

## 워크플로우 A: 소스 분석 모드

기존 소스코드를 분석하여 새 아키텍처 스펙을 작성합니다.

1. **spec-mode.md** 가이드를 읽습니다
2. 입력 파라미터를 위 규칙에 따라 판별하고 대상 모듈을 식별합니다
3. 기존 스펙이 있는지 `docs/specs/` 디렉토리를 확인합니다
4. **기존 소스 분석** (legacy-analyzer agent 활용 권장):
   - Task 도구로 legacy-analyzer 호출 (module_name, platforms=M+B)
   - 에이전트 분석 결과를 기반으로 다음 단계 진행
   - 에이전트 사용 불가 시: spec-mode.md의 "기존 소스 분석 전략" 절차 직접 수행
5. 분석 결과를 기반으로 해당 플랫폼 스펙 템플릿(`docs/specs/templates/`)을 읽습니다
6. **Backend(B) 스펙 초안을 먼저 작성**합니다:
   - 기존 Controller endpoints → REST API 설계
   - 기존 Mapper SQL → 데이터 모델
   - 기존 Service → 비즈니스 로직 (자연어 규칙)
7. **Mobile(M) 스펙 초안을 작성**합니다:
   - Backend API 계약 기반 화면 설계
   - 기존 JSP UI → 텍스트 와이어프레임
8. 사용자에게 B+M 스펙 모두에 대해 승인 체크리스트와 함께 리뷰를 요청합니다

## 워크플로우 B: 대화 기반 모드

기존 소스 참조 없이 사용자와의 대화를 통해 스펙을 작성합니다.

1. **spec-mode.md** 가이드를 읽습니다
2. 사용자에게 작업 유형을 확인합니다 (Feature / Refactor / System / Bug)
3. **대화를 통한 요구사항 수집**:
   - 작업의 목적과 배경
   - 완료 조건 (Definition of Done)
   - 영향 범위 (어떤 플랫폼에 해당하는지)
   - 기술적 제약사항
4. 기존 스펙이 있는지 `docs/specs/` 디렉토리를 확인합니다
5. 적절한 템플릿을 선택합니다:
   - Feature → `Feature-B/M/W-Template.md` (플랫폼에 따라)
   - R/S/B → `Task-Template.md`
6. 스펙 초안을 작성합니다
7. 사용자에게 승인 체크리스트와 함께 리뷰를 요청합니다
